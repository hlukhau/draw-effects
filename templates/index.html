<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drawing Effects - Photo to Drawing Video</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <header class="text-center py-4">
            <h1 class="display-4 text-primary">
                <i class="fas fa-paint-brush"></i> Drawing Effects
            </h1>
            <p class="lead text-muted">Transform your photos into animated drawing videos</p>
        </header>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Upload Section -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-upload"></i> Upload Photo</h5>
                    </div>
                    <div class="card-body">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-content">
                                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                <h5>Drag & drop your photo here</h5>
                                <p class="text-muted">or click to browse</p>
                                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                                <button id="chooseFileBtn" class="btn btn-outline-primary">
                                    Choose File
                                </button>
                            </div>
                        </div>
                        
                        <div id="imagePreview" class="mt-3" style="display: none;">
                            <img id="previewImg" class="img-fluid rounded" style="max-height: 300px;">
                            <div class="mt-2">
                                <span id="fileName" class="text-muted"></span>
                                <button class="btn btn-sm btn-outline-danger ms-2" onclick="clearImage()">
                                    <i class="fas fa-times"></i> Remove
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-cog"></i> Drawing Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <label for="styleSelect" class="form-label">Drawing Style</label>
                                <select class="form-select" id="styleSelect">
                                    <option value="pencil" selected>Pencil Sketching</option>
                                    <option value="brush">Brush Painting</option>
                                    <option value="sprite_brush">Sprite Brush Painting</option>
                                </select>
                                <div class="form-text">Choose between pencil sketching (hatching), brush painting (dots), or sprite brush painting (textured brush strokes)</div>
                            </div>
                            <div class="col-md-4">
                                <label for="colorThreshold" class="form-label">Color Sensitivity: <span id="thresholdValue">30</span></label>
                                <input type="range" class="form-range" id="colorThreshold" min="5" max="100" value="30">
                                <div class="form-text">Lower values = more segments (finer details)</div>
                            </div>
                            <div class="col-md-4">
                                <label for="videoDuration" class="form-label">Video Duration: <span id="durationValue">10</span>s</label>
                                <input type="range" class="form-range" id="videoDuration" min="5" max="60" value="10">
                                <div class="form-text">Duration of the drawing animation</div>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <label for="strokeDensity" class="form-label">Stroke Density: <span id="densityValue">1.0</span>x</label>
                                <input type="range" class="form-range" id="strokeDensity" min="0.5" max="10.0" step="0.1" value="1.0">
                                <div class="form-text">Higher values = more dense strokes (up to 10x for maximum density)</div>
                            </div>
                            <div class="col-md-4">
                                <label for="videoFps" class="form-label">Video FPS: <span id="fpsValue">30</span></label>
                                <select class="form-select" id="videoFps">
                                    <option value="30" selected>30 FPS</option>
                                    <option value="60">60 FPS</option>
                                </select>
                                <div class="form-text">Frames per second for smoother video</div>
                            </div>
                            <div class="col-md-4">
                                <label for="boundarySensitivity" class="form-label">Boundary Sensitivity: <span id="sensitivityValue">50</span></label>
                                <input type="range" class="form-range" id="boundarySensitivity" min="1" max="100" value="50">
                                <div class="form-text">Higher values find weaker/subtle boundaries, lower values find only strong boundaries</div>
                            </div>
                            <div class="col-md-4">
                                <label for="boundaryFragmentation" class="form-label">Boundary Fragmentation: <span id="fragmentationValue">1</span></label>
                                <input type="range" class="form-range" id="boundaryFragmentation" min="1" max="6" value="1">
                                <div class="form-text">Split each boundary into 1-6 fragments (1=no split, 6=maximum fragments)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Process Section -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-magic"></i> Generate Drawing Effect</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <button id="segmentBtn" class="btn btn-info btn-lg mb-2" disabled onclick="processSegmentation()">
                                    <i class="fas fa-eye"></i> Show Segmentation
                                </button>
                                <div class="form-text">Preview how the image will be segmented into detail levels</div>
                            </div>
                            <div class="col-md-6">
                                <button id="boundariesBtn" class="btn btn-secondary btn-lg mb-2" disabled onclick="detectBoundaries()">
                                    <i class="fas fa-search"></i> Detect Boundaries
                                </button>
                                <div class="form-text">Find contrast boundaries for individual drawing</div>
                            </div>
                        </div>
                        
                        <div id="processingStatus" class="mt-3" style="display: none;">
                            <div class="progress mb-2">
                                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 0%"></div>
                            </div>
                            <div id="statusMessage" class="text-muted">Processing...</div>
                        </div>
                    </div>
                </div>

                <!-- Effects Section -->
                <div id="effectsSection" class="card mb-4 shadow-sm" style="display: none;">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0"><i class="fas fa-magic"></i> Visual Effects</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="fas fa-lightbulb"></i> Flash Effect</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="reliefStrength" class="form-label">Relief Strength: <span id="reliefStrengthValue">0.01</span></label>
                                            <input type="range" class="form-range" id="reliefStrength" min="0.005" max="0.1" step="0.005" value="0.01">
                                            <div class="form-text">Controls the depth of the relief effect</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="lightMovements" class="form-label">Light Movements: <span id="lightMovementsValue">1</span></label>
                                            <input type="range" class="form-range" id="lightMovements" min="1" max="5" value="1">
                                            <div class="form-text">Number of light source movements</div>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button id="applyFlashEffectBtn" class="btn btn-warning">
                                                <i class="fas fa-bolt"></i> Apply Flash Effect
                                            </button>
                                            <button id="previewFlashBtn" class="btn btn-outline-warning">
                                                <i class="fas fa-eye"></i> Preview Effect
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="fas fa-film"></i> Effect Animation</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="effectDuration" class="form-label">Effect Duration: <span id="effectDurationValue">3</span>s</label>
                                            <input type="range" class="form-range" id="effectDuration" min="1" max="10" value="3">
                                            <div class="form-text">Duration of the effect animation</div>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button id="animateEffectBtn" class="btn btn-success">
                                                <i class="fas fa-play"></i> Animate Effect
                                            </button>
                                            <button id="stopEffectBtn" class="btn btn-outline-danger" style="display: none;">
                                                <i class="fas fa-stop"></i> Stop Animation
                                            </button>
                                        </div>
                                        <div class="mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle"></i>
                                                Effect frames will be added to video generation
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Effect Preview Area -->
                        <div id="effectPreviewArea" class="mt-4" style="display: none;">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0"><i class="fas fa-image"></i> Effect Preview</h6>
                                </div>
                                <div class="card-body text-center">
                                    <img id="effectPreviewImg" class="img-fluid rounded" style="max-height: 400px;">
                                    <div class="mt-2">
                                        <div id="effectProgress" class="progress" style="display: none;">
                                            <div id="effectProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                                 role="progressbar" style="width: 0%"></div>
                                        </div>
                                        <div id="effectStatus" class="text-muted mt-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Animation Section -->
                <div id="animationSection" class="card mb-4 shadow-sm" style="display: none;">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-play-circle"></i> Animation</h5>
                    </div>
                    <div class="card-body">
                        <!-- Interactive Canvas Area -->
                        <div id="interactiveCanvasArea" class="mb-4">
                            <!-- Canvas will be dynamically created here -->
                        </div>
                        
                        <!-- Animation Controls -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="fas fa-paint-brush"></i> Drawing Controls</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <button id="startDrawingBtn" class="btn btn-success">
                                                <i class="fas fa-play"></i> Start Drawing Animation
                                            </button>
                                            <button id="pauseDrawingBtn" class="btn btn-warning" style="display: none;">
                                                <i class="fas fa-pause"></i> Pause Drawing
                                            </button>
                                            <button id="drawEffectBtn" class="btn btn-info">
                                                <i class="fas fa-magic"></i> Прорисовать эффект
                                            </button>
                                            <button id="resetDrawingBtn" class="btn btn-outline-secondary">
                                                <i class="fas fa-redo"></i> Reset Canvas
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="fas fa-video"></i> Video Generation</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <button id="generateVideoBtn" class="btn btn-primary">
                                                <i class="fas fa-film"></i> Generate Video
                                            </button>
                                            <button id="downloadVideoBtn" class="btn btn-success" style="display: none;">
                                                <i class="fas fa-download"></i> Download Video
                                            </button>
                                        </div>
                                        <div class="mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle"></i>
                                                Creates time-lapse video of drawing process
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Video Preview Area -->
                        <div id="videoPreviewArea" class="text-center" style="display: none;">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0"><i class="fas fa-film"></i> Generated Video</h6>
                                </div>
                                <div class="card-body">
                                    <video id="resultVideo" class="w-100 rounded" controls style="max-height: 400px;">
                                        Your browser does not support the video tag.
                                    </video>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interactive Canvas Section - Legacy (will be moved to Animation) -->
                <div id="interactiveCanvas" class="card mb-4 shadow-sm" style="display: none;">
                    <!-- This section is now moved to Animation tab -->
                </div>

                <!-- Boundary Results Section -->
                <div id="boundaryResults" class="card mb-4 shadow-sm" style="display: none;">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">
                            <button class="btn btn-link text-white text-decoration-none p-0" type="button" data-bs-toggle="collapse" data-bs-target="#boundaryDetailsCollapse" aria-expanded="false" aria-controls="boundaryDetailsCollapse">
                                <i class="fas fa-border-style me-2"></i> Detected Boundaries
                                <i class="fas fa-chevron-down ms-2" id="boundaryChevron"></i>
                            </button>
                        </h5>
                    </div>
                    <div class="collapse" id="boundaryDetailsCollapse">
                        <div class="card-body">
                            <div id="boundaryInfo" class="mb-3">
                                <!-- Boundary summary will be loaded here -->
                            </div>
                            <div class="mb-3 text-center">
                                <button id="drawAllBoundariesBtn" class="btn btn-success" onclick="drawAllBoundaries()" style="display: none;">
                                    <i class="fas fa-paint-brush"></i> Draw All Boundaries
                                </button>
                            </div>
                            <div id="boundaryList" class="table-responsive">
                                <!-- Boundary list will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Segmentation Results Section -->
                <div id="segmentationResults" class="card mb-4 shadow-sm" style="display: none;">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <button class="btn btn-link text-white text-decoration-none p-0" type="button" data-bs-toggle="collapse" data-bs-target="#segmentationDetailsCollapse" aria-expanded="false" aria-controls="segmentationDetailsCollapse">
                                <i class="fas fa-images me-2"></i> Segmentation Results
                                <i class="fas fa-chevron-down ms-2" id="segmentationChevron"></i>
                            </button>
                        </h5>
                    </div>
                    <div class="collapse" id="segmentationDetailsCollapse">
                        <div class="card-body">
                            <div id="segmentationImages" class="d-flex flex-nowrap justify-content-between">
                                <!-- Segmentation images will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <footer class="text-center py-4 mt-5">
            <div class="text-muted">
                <p>Transform your photos into beautiful drawing animations</p>
                <small>Supports Pencil Sketching and Brush Painting styles</small>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
